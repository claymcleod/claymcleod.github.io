<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>WR Visualizations</title>
		
		<script type="text/javascript" src="d3/d3.v3.js"></script>
		<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="main.css">
		<script>
			var _gaq = _gaq || [];
			var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
			_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
			_gaq.push(['_setAccount', 'UA-40368986-4']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'http://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		</script>
	</head>
	<body>
<!--		<h1> Wide Receiver Visualization</h1>
			<p> 
				Hello! This is a beta preview of my newest data visualization for WRs. 
				This particular graph shows a WR's fantasy points vs. the amount of targets
				he gets, although there are <a href="http://claymcleod.github.io/blog/articles/week8-wr/">a few more</a>.
				Please let me know what you think! (Click the buttons to make the graph change)
			</p>-->
		<center>
		  <h2><a href="http://claymcleod.github.io/fflconsole/">Back toFFL Console</a></h2>
			<select id="x_select" style="display: none;"></select>
			<select id="y_select" style="display: none;"></select>
			<button type="button" onclick="rotateX()">Rotate X Axis</button>
			<button type="button" onclick="rotateY()">Rotate Y Axis</button>
		</center>
		<script type="text/javascript">
		/*	   
			var data = d3.csv("wr_visualization.csv", function(player)
			{
				console.log("Player:", player)
				data = player.map(function(d)
				{
					console.log(d)
					return {
						"Name":d.Name, "Targets":+d.Targets, "YPC":+d.YPC
					}
				})
				
				return data
			})
		*/
		var headers = ["Name", "Targets", "Receptions", "Yards", "TDs", "YPC", "Fantasy Points"]
		
		var data = [
		           ["Calvin Johnson",52,29,461,3,15.90,64.10] ,
["Demaryius Thomas",101,65,1002,6,15.42,136.20] ,
["Jordy Nelson",84,56,889,8,15.88,136.90] ,
["Antonio Brown",112,79,1070,8,13.54,155.00] ,
["Randall Cobb",61,44,650,10,14.77,125.00] ,
["Julio Jones",94,61,853,3,13.98,103.30] ,
["Emmanuel Sanders",84,62,852,6,13.74,121.20] ,
["A.J. Green",41,23,381,3,16.57,56.10] ,
["Ty Hilton",84,56,937,3,16.73,111.70] ,
["Jeremy Maclin",83,45,790,8,17.56,127.00] ,
["Alshon Jeffery",73,44,626,3,14.23,80.60] ,
["Kelvin Benjamin",78,40,589,5,14.72,88.90] ,
["Brandon Marshall",76,42,496,6,11.81,85.60] ,
["DeSean Jackson",61,36,784,4,21.78,102.40] ,
["Golden Tate",93,66,909,3,13.77,108.90] ,
["Mike Evans",62,39,585,5,15.00,88.50] ,
["Mike Wallace",75,40,519,6,12.97,87.90] ,
["Vincent Jackson",90,40,518,2,12.95,63.80] ,
["Brandon LaFell",63,36,514,5,14.28,81.40] ,
["Roddy White",67,39,491,4,12.59,73.10] ,
["Odell Beckham Jr.",35,25,370,3,14.80,55.00] ,
["Sammy Watkins",77,42,617,5,14.69,91.70] ,
["Martavis Bryant",24,14,310,6,22.14,67.00] ,
["DeAndre Hopkins",64,42,684,4,16.29,92.40] ,
["Keenan Allen",73,47,474,1,10.09,53.40] ,
["Mohamed Sanu",73,41,648,4,15.80,88.80] ,
["Anquan Boldin",77,51,635,3,12.45,81.50] ,
["Julian Edelman",79,54,556,2,10.30,67.60] ,
["Pierre Garcon",62,42,458,3,10.90,63.80] ,
["Andre Johnson",82,48,563,1,11.73,62.30] ,
["Larry Fitzgerald",65,44,625,2,14.20,74.50] ,
["Brandin Cooks",62,48,500,3,10.42,68.00] ,
["Reggie Wayne",72,42,504,2,12.00,62.40] ,
["Michael Crabtree",68,40,424,3,10.60,60.40] ,
["Rueben Randle",79,43,409,2,9.51,52.90] ,
["Doug Baldwin",55,38,440,1,11.58,50.00] ,
["Jordan Matthews",52,32,313,3,9.78,49.30] ,
["James Jones",71,47,463,3,9.85,64.30] ,
["Cordarrelle Patterson",56,26,308,1,11.85,36.80] ,
["Michael Floyd",52,24,400,2,16.67,52.00] ,
["Kenny Britt",40,21,312,2,14.86,43.20] ,
["Marques Colston",50,30,480,1,16.00,54.00] ,
["John Brown",57,29,399,5,13.76,69.90] ,
["Malcom Floyd",44,28,530,3,18.93,71.00] ,
["Andrew Hawkins",69,39,504,1,12.92,56.40] ,
["Kendall Wright",60,39,403,4,10.33,64.30] ,
["Justin Hunter",50,21,368,2,17.52,48.80] ,
["Greg Jennings",58,35,459,2,13.11,57.90] ,
["Andre Holmes",47,25,400,4,16.00,64.00] ,
["Jarvis Landry",50,37,354,2,9.57,47.40] ,



			  ];
			
		var x_axis_columns = [1, 2, 3, 4, 5, 6] // Must always be ascending order of columns for label indexing!
		var y_axis_columns = [1, 2, 3, 4, 5, 6] // Must always be ascending order of columns for label indexing!
		var current_x_axis = 5
		var current_y_axis = 0
		
		var padding = 30;
		var width_of_svg = 1000;
		var height_of_svg = 600;
		
		// Setup
		
		var select = document.getElementById("x_select");
		
		for(var i = 0; i < headers.length; i++) {
    		var opt = headers[i];
    		var el = document.createElement("option");
    		el.textContent = opt;
    		el.value = opt;
    		select.appendChild(el);
		}	
		
		var select = document.getElementById("y_select");
		
		for(var i = 0; i < y_axis_columns.length; i++) {
    		var opt = headers[y_axis_columns[i]];
    		var el = document.createElement("option");
    		el.textContent = opt;
    		el.value = opt;
    		select.appendChild(el);
		}	

		// Calculations
		var array = create_scatterplot(data, "Targets vs. Fantasy Points", 1, "Targets", 6, "Fantasy Points (Standard)")
		var circles = array[0]
		var svg = array[1]
		//create_scatterplot(data, "Targets vs. Yards", 1, "Targets", 3, "Yards")
		//create_scatterplot(data, "YPC vs. Fantasy Points", 5, "Yards Per Catch", 6, "Fantasy Points (Standard)")
		
		// FUNCTIONS
		
		function create_scatterplot(data, title, x_axis_column, x_label, y_axis_column, y_label) {
			
	
			
			//Create scale functions
			var xScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[x_axis_column]; }) - 5, d3.max(data, function(d) { return d[x_axis_column]; }) + 5])
								 .range([padding, width_of_svg - padding * 2]);

			var yScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[y_axis_column]; }) - 5, d3.max(data, function(d) { return d[y_axis_column]; }) + 5])
								 .range([height_of_svg - padding, padding]);

			var rScale = d3.scale.linear()
								 .domain([1, data.length])
								 .range([20, 3]);
								 
			var colorScale = d3.scale.linear()
								 .domain([1, data.length / 2, data.length])
								 .range(["red", "orange", "green"]);

			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(5);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);
			
			
			var svg = d3.select("body")
				.append("svg")
				.style("display", "block")
				.style("width", width_of_svg + "px") 
				.style("height", height_of_svg + "px")
				.style("margin-left", "auto")
				.style("margin-right", "auto")
				.style("padding-bottom", "55px");
			
			svg.append("text")
				.attr("x", (width_of_svg / 2))			   
				.attr("y", 45)
				.attr("text-anchor", "middle")	
				.style("font-size", "36px") 
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text(title);
				
			var tooltip = d3.select("body")
				.append("div")
				.style("position", "absolute")
				.style("z-index", "10")
				.style("visibility", "hidden")
				.style("font-size", "16px")
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text("");
			
			var circles = svg.selectAll("circle")
			   .data(data)
			   .enter()
			   .append("circle")
			   .attr("cx", function(d) {
					return xScale(d[x_axis_column]);
			   })
			   .attr("cy", function(d) {
					return yScale(d[y_axis_column]);
			   })
			   .attr("r", function(d, i) {
					return rScale(i);
			   })
			   .attr("fill", function(d, i) {
					return colorScale(i);
			   })
			   .attr("stroke", "black")
			   .attr("stroke-width", 1)
			   .on("mouseover", function(d) {	   
					d3.select(this).transition()		
					.duration(200)		
					.style("opacity", 1);  
					return tooltip.style("visibility", "visible");	 
			})	 
			.on("mousemove", function(d, i){
				var name = data[i][0]
				return tooltip.text(name).style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
			})				 
			.on("mouseout", function(d) {  
				d3.select(this).transition()		
					.duration(200)		
					.style("opacity", .35); 
				return tooltip.style("visibility", "hidden");	
			});
			   
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (height_of_svg - padding) + ")")
				.call(xAxis);
			
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
				
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", width_of_svg - 68)
				.attr("y", height_of_svg - 38)
				.text(x_label);
	
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", -38)
				.attr("y", 38)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text(y_label);
	
			circles.transition()
				 .duration(3000)
				 .style("opacity", 0.35);
				 
			return [circles, svg];
		}
		
		function renderNextVisualization() {
			var i = current_y_axis;
				
			//Create scale functions
			var xScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[x_axis_columns[current_x_axis]]; }) - 5, d3.max(data, function(d) { return d[x_axis_columns[current_x_axis]]; }) + 5])
								 .range([padding, width_of_svg - padding * 2]);

			var yScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[y_axis_columns[current_y_axis]]; }) - 5, d3.max(data, function(d) { return d[y_axis_columns[current_y_axis]]; }) + 5])
								 .range([height_of_svg - padding, padding]);

			var rScale = d3.scale.linear()
								 .domain([1, data.length])
								 .range([20, 3]);
								 
			var colorScale = d3.scale.linear()
								 .domain([1, data.length / 2, data.length])
								 .range(["red", "orange", "green"]);

			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(5);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);
			
			svg.selectAll("g").remove()
			svg.selectAll("text").remove()
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (height_of_svg - padding) + ")")
				.call(xAxis);
			
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
				
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", width_of_svg - 68)
				.attr("y", height_of_svg - 38)
				.text(headers[x_axis_columns[0] + current_x_axis]);
	
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", -38)
				.attr("y", 38)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text(headers[y_axis_columns[0] + current_y_axis]);
			
			svg.append("text")
				.attr("x", (width_of_svg / 2))			   
				.attr("y", 45)
				.attr("text-anchor", "middle")	
				.style("font-size", "36px") 
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text(headers[x_axis_columns[current_x_axis]] +" vs. "+headers[y_axis_columns[0] + current_y_axis]);
						
			circles.transition()
				.attr("cx", function(d, i) {
  					return xScale(data[i][x_axis_columns[current_x_axis]]);
  				})
  				.attr("cy", function(d, i) {
  					return yScale(data[i][y_axis_columns[current_y_axis]]);
  				})
  				.duration(1000) // this is 1s
  				.delay(100)     // this is 0.1s	
		
			return i;
		}
		
		function rotateX() {
			current_x_axis = current_x_axis + 1;
			
			if (current_x_axis == current_y_axis) {
				current_x_axis = current_x_axis + 1
			}
			
			if(current_x_axis > (x_axis_columns.length - 1)) {
				current_x_axis = 0;
			}
			
			if (current_x_axis == current_y_axis) {
				current_x_axis = current_x_axis + 1
			}
			renderNextVisualization()
		}
		
		function rotateY() {
			current_y_axis = current_y_axis + 1;
			
			if (current_x_axis == current_y_axis) {
				current_y_axis = current_y_axis + 1
			}
			
			if(current_y_axis > (y_axis_columns.length - 1)) {
				current_y_axis = 0;
			}
			
			if (current_x_axis == current_y_axis) {
				current_y_axis = current_y_axis + 1
			}
			
			renderNextVisualization()
		}

		</script>
	</body>
</html>
