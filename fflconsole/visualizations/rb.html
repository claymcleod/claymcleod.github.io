<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>RB Visualizations</title>
		
		<script type="text/javascript" src="d3/d3.v3.js"></script>
		<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" type="text/css" href="main.css">
		<script>
			var _gaq = _gaq || [];
			var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
			_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
			_gaq.push(['_setAccount', 'UA-40368986-4']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'http://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		</script>
	</head>
<!--	<body>
		<h1> Running Back Visualization</h1>
			<p> 
				Hello! This is a beta preview of my newest data visualization for RBs. 
				This particular graph shows a RB's fantasy points vs. the amount of targets
				he gets, although there are <a href="http://claymcleod.github.io/blog/articles/week8-rb/">a few more</a>.
				Please let me know what you think! (Click the buttons to make the graph change)
			</p>-->
		<center>
		  <h2><a href="http://claymcleod.github.io/fflconsole/">Back to FFL Console</a></h2>
			<select id="x_select" style="display: none;"></select>
			<select id="y_select" style="display: none;"></select>
			<button type="button" onclick="rotateX()">Rotate X Axis</button>
			<button type="button" onclick="rotateY()">Rotate Y Axis</button>
		</center>
		<script type="text/javascript">

		var headers = ["Name","Attempts","Yards","Tds","Fumbles","YPC","Fantasy Points"]	
		var data = [
		["DeMarco Murray",244,1233,7,0,5.05,183.40] ,
["Matt Forte",173,733,3,3,4.24,164.80] ,
["Jamaal Charles",133,692,8,2,5.20,138.00] ,
["Arian Foster",161,822,7,3,5.11,161.10] ,
["Eddie Lacy",129,548,5,2,4.25,125.00] ,
["Marshawn Lynch",177,813,9,3,4.59,176.00] ,
["LeSean McCoy",196,729,2,0,3.72,91.90] ,
["Mark Ingram",138,618,6,0,4.48,107.50] ,
["Andre Ellington",186,624,3,2,3.35,124.00] ,
["Denard Robinson",100,483,4,0,4.83,77.00] ,
["Rashad Jennings",109,455,2,0,4.17,67.20] ,
["C.J. Anderson",39,201,0,1,5.15,45.40] ,
["Justin Forsett",133,721,5,0,5.42,120.30] ,
["Alfred Morris",172,701,6,0,4.08,112.50] ,
["Trent Richardson",115,391,2,0,3.40,67.40] ,
["Jeremy Hill",113,556,5,0,4.92,97.50] ,
["Frank Gore",158,648,2,1,4.10,90.60] ,
["Giovani Bernard",109,446,5,0,4.09,92.50] ,
["Joique Bell",122,442,3,0,3.62,76.60] ,
["Tre Mason",92,383,1,0,4.16,46.20] ,
["Ryan Mathews",39,141,1,0,3.62,23.20] ,
["Lamar Miller",125,614,5,1,4.91,106.60] ,
["Shane Vereen",70,328,1,3,4.69,87.30] ,
["Isaiah Crowell",78,358,5,0,4.59,64.40] ,
["Steven Jackson",128,467,4,0,3.65,78.70] ,
["Jonas Gray",70,330,4,0,4.71,57.00] ,
["Fred Jackson",58,249,1,1,4.29,62.90] ,
["Jerick McKinnon",98,484,0,0,4.94,61.00] ,
["Bishop Sankey",91,357,1,0,3.92,50.00] ,
["Christopher Ivory",123,548,5,0,4.46,93.10] ,


		]
		var x_axis_columns = [1, 2, 3, 4, 5, 6] // Must always be ascending order of columns for label indexing!
		var y_axis_columns = [1, 2, 3, 4, 5, 6] // Must always be ascending order of columns for label indexing!
		var current_x_axis = 5
		var current_y_axis = 0
		
		var padding = 30;
		var width_of_svg = 1000;
		var height_of_svg = 600;
		
		// Setup
		
		var select = document.getElementById("x_select");
		
		for(var i = 0; i < headers.length; i++) {
    		var opt = headers[i];
    		var el = document.createElement("option");
    		el.textContent = opt;
    		el.value = opt;
    		select.appendChild(el);
		}	
		
		var select = document.getElementById("y_select");
		
		for(var i = 0; i < y_axis_columns.length; i++) {
    		var opt = headers[y_axis_columns[i]];
    		var el = document.createElement("option");
    		el.textContent = opt;
    		el.value = opt;
    		select.appendChild(el);
		}	

		// Calculations
		
		var array = create_scatterplot(data, "Attempts vs. Fantasy Points", 1, "Targets", 6, "Fantasy Points (Standard)")
		var circles = array[0]
		var svg = array[1]
		
		// FUNCTIONS
		
		function create_scatterplot(data, title, x_axis_column, x_label, y_axis_column, y_label) {
			
	
			
			//Create scale functions
			var xScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[x_axis_column]; }) - 5, d3.max(data, function(d) { return d[x_axis_column]; }) + 5])
								 .range([padding, width_of_svg - padding * 2]);

			var yScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[y_axis_column]; }) - 5, d3.max(data, function(d) { return d[y_axis_column]; }) + 5])
								 .range([height_of_svg - padding, padding]);

			var rScale = d3.scale.linear()
								 .domain([1, data.length])
								 .range([20, 3]);
								 
			var colorScale = d3.scale.linear()
								 .domain([1, data.length / 2, data.length])
								 .range(["red", "orange", "green"]);

			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(5);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);
			
			
			var svg = d3.select("body")
				.append("svg")
				.style("display", "block")
				.style("width", width_of_svg + "px") 
				.style("height", height_of_svg + "px")
				.style("margin-left", "auto")
				.style("margin-right", "auto")
				.style("padding-bottom", "55px");
			
			svg.append("text")
				.attr("x", (width_of_svg / 2))			   
				.attr("y", 45)
				.attr("text-anchor", "middle")	
				.style("font-size", "36px") 
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text(title);
				
			var tooltip = d3.select("body")
				.append("div")
				.style("position", "absolute")
				.style("z-index", "10")
				.style("visibility", "hidden")
				.style("font-size", "16px")
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text("");
			
			var circles = svg.selectAll("circle")
			   .data(data)
			   .enter()
			   .append("circle")
			   .attr("cx", function(d) {
					return xScale(d[x_axis_column]);
			   })
			   .attr("cy", function(d) {
					return yScale(d[y_axis_column]);
			   })
			   .attr("r", function(d, i) {
					return rScale(i);
			   })
			   .attr("fill", function(d, i) {
					return colorScale(i);
			   })
			   .attr("stroke", "black")
			   .attr("stroke-width", 1)
			   .on("mouseover", function(d) {	   
					d3.select(this).transition()		
					.duration(200)		
					.style("opacity", 1);  
					return tooltip.style("visibility", "visible");	 
			})	 
			.on("mousemove", function(d, i){
				var name = data[i][0]
				return tooltip.text(name).style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
			})				 
			.on("mouseout", function(d) {  
				d3.select(this).transition()		
					.duration(200)		
					.style("opacity", .35); 
				return tooltip.style("visibility", "hidden");	
			});
			   
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (height_of_svg - padding) + ")")
				.call(xAxis);
			
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
				
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", width_of_svg - 68)
				.attr("y", height_of_svg - 38)
				.text(x_label);
	
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", -38)
				.attr("y", 38)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text(y_label);
	
			circles.transition()
				 .duration(3000)
				 .style("opacity", 0.35);
				 
			return [circles, svg];
		}
		
		function renderNextVisualization() {
			var i = current_y_axis;
				
			//Create scale functions
			var xScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[x_axis_columns[current_x_axis]]; }) - 5, d3.max(data, function(d) { return d[x_axis_columns[current_x_axis]]; }) + 5])
								 .range([padding, width_of_svg - padding * 2]);

			var yScale = d3.scale.linear()
								 .domain([d3.min(data, function(d) { return d[y_axis_columns[current_y_axis]]; }) - 5, d3.max(data, function(d) { return d[y_axis_columns[current_y_axis]]; }) + 5])
								 .range([height_of_svg - padding, padding]);

			var rScale = d3.scale.linear()
								 .domain([1, data.length])
								 .range([20, 3]);
								 
			var colorScale = d3.scale.linear()
								 .domain([1, data.length / 2, data.length])
								 .range(["red", "orange", "green"]);

			//Define X axis
			var xAxis = d3.svg.axis()
							  .scale(xScale)
							  .orient("bottom")
							  .ticks(5);

			//Define Y axis
			var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(5);
			
			svg.selectAll("g").remove()
			svg.selectAll("text").remove()
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(0," + (height_of_svg - padding) + ")")
				.call(xAxis);
			
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis);
				
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", width_of_svg - 68)
				.attr("y", height_of_svg - 38)
				.text(headers[x_axis_columns[0] + current_x_axis]);
	
			svg.append("text")
				.attr("text-anchor", "end")
				.attr("x", -38)
				.attr("y", 38)
				.attr("dy", ".75em")
				.attr("transform", "rotate(-90)")
				.text(headers[y_axis_columns[0] + current_y_axis]);
			
			svg.append("text")
				.attr("x", (width_of_svg / 2))			   
				.attr("y", 45)
				.attr("text-anchor", "middle")	
				.style("font-size", "36px") 
				.style("font-family", "Baskerville, \"Times New Roman\", serif")
				.text(headers[x_axis_columns[current_x_axis]] +" vs. "+headers[y_axis_columns[0] + current_y_axis]);
						
			circles.transition()
				.attr("cx", function(d, i) {
  					return xScale(data[i][x_axis_columns[current_x_axis]]);
  				})
  				.attr("cy", function(d, i) {
  					return yScale(data[i][y_axis_columns[current_y_axis]]);
  				})
  				.duration(1000) // this is 1s
  				.delay(100)     // this is 0.1s	
		
			return i;
		}
		
		function rotateX() {
			current_x_axis = current_x_axis + 1;
			
			if (current_x_axis == current_y_axis) {
				current_x_axis = current_x_axis + 1
			}
			
			if(current_x_axis > (x_axis_columns.length - 1)) {
				current_x_axis = 0;
			}
			
			if (current_x_axis == current_y_axis) {
				current_x_axis = current_x_axis + 1
			}
			renderNextVisualization()
		}
		
		function rotateY() {
			current_y_axis = current_y_axis + 1;
			
			if (current_x_axis == current_y_axis) {
				current_y_axis = current_y_axis + 1
			}
			
			if(current_y_axis > (y_axis_columns.length - 1)) {
				current_y_axis = 0;
			}
			
			if (current_x_axis == current_y_axis) {
				current_y_axis = current_y_axis + 1
			}
			
			renderNextVisualization()
		}

		</script>
	</body>
</html>
